# Hyper-V ê¸°ë°˜ Kubernetes ë©€í‹° ë…¸ë“œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ìë™í™”

ë³¸ í”„ë¡œì íŠ¸ëŠ” **Windows 11** í™˜ê²½ì˜ **Hyper-V**ì—ì„œ **PXE ì„œë²„ì™€ Ansible**ì„ í™œìš©í•˜ì—¬ **Kubernetes ë©€í‹° ë…¸ë“œ í´ëŸ¬ìŠ¤í„°**ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ìµœì†Œí•œì˜ ìˆ˜ì‘ì—…ë§Œìœ¼ë¡œ OS ì„¤ì¹˜ë¶€í„° Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì„±ê¹Œì§€ ë¬´ì¸í™”í•˜ì—¬, ë¹ ë¥´ê²Œ ë©€í‹° ë…¸ë“œ í™˜ê²½ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“Œ ëª©ì°¨ (Table of Contents)

1. [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì•„í‚¤í…ì²˜ êµ¬ì„±](#ì•„í‚¤í…ì²˜-êµ¬ì„±)
3. [ìš”êµ¬ ì‚¬í•­ (Requirements)](#ìš”êµ¬-ì‚¬í•­-requirements)
4. [êµ¬ì¶• ë°©ë²• (Installation)](#êµ¬ì¶•-ë°©ë²•-installation)
5. [ì‚¬ìš© ì˜ˆì‹œ (Usage)](#ì‚¬ìš©-ì˜ˆì‹œ-usage)
6. [ê²°ê³¼ ê²€ì¦ ë° í…ŒìŠ¤íŠ¸](#ê²°ê³¼-ê²€ì¦-ë°-í…ŒìŠ¤íŠ¸)
7. [íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ê²½í—˜](#íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…-ê²½í—˜)
8. [í–¥í›„ ê°œì„  ë°©í–¥](#í”¼ë“œë°±-ë°-í–¥í›„-ë””ë²¨ë¡­-ë°©í–¥ì„±)
9. [ì°¸ê³  ìë£Œ](#ì°¸ê³ -ìë£Œ)

---

## í”„ë¡œì íŠ¸ ê°œìš”

### ëª©í‘œ
- Hyper-V ê¸°ë°˜ Kubernetes í´ëŸ¬ìŠ¤í„° (ì»¨íŠ¸ë¡¤ëŸ¬, ìŠ¤í† ë¦¬ì§€, ì›Œì»¤ ë…¸ë“œ) ìë™í™” êµ¬ì¶•
- PXE ì„œë²„ë¡œ Rocky Linux 9 OSë¥¼ ìë™ ì„¤ì¹˜
- Ansibleë¡œ Kubernetes í™˜ê²½ ë° CNI êµ¬ì„±ì„ ë¬´ì¸ ìë™í™”

### í”„ë¡œì íŠ¸ ë²”ìœ„
- Hyper-V í™˜ê²½ ì„¤ì • (VM ìƒì„± ë° ê°€ìƒ ìŠ¤ìœ„ì¹˜ êµ¬ì„±)
- PXE ì„œë²„ ë° OS ìë™ ì„¤ì¹˜ (Rocky Linux 9)
- Ansibleì„ í†µí•œ Kubernetes ìë™ ì„¤ì¹˜ ë° CNI ì„¤ì •
- Kubernetes í´ëŸ¬ìŠ¤í„° ê²€ì¦ ë° ê°„ë‹¨í•œ ì›Œí¬ë¡œë“œ ë°°í¬ í…ŒìŠ¤íŠ¸

---

## ì•„í‚¤í…ì²˜ êµ¬ì„±

### ë¬¼ë¦¬ ì•„í‚¤í…ì²˜

ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” Windows 11 í™˜ê²½ ìœ„ì— Hyper-V ê¸°ë°˜ì˜ ë©€í‹° ë…¸ë“œ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.

- 2ëŒ€ì˜ Windows 11 ë°ìŠ¤í¬íƒ‘(A, B) ìœ„ì—ì„œ Hyper-V í™œì„±í™” í›„ ê°€ìƒ ìŠ¤ìœ„ì¹˜ ìƒì„±.
- External Virtual Switchë¥¼ í†µí•´ ë¬¼ë¦¬ ëœ ì¹´ë“œì™€ ë¸Œë¦¬ì§€ë¡œ ì—°ê²°í•˜ì—¬ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬(ì¸í„°ë„·) ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±.
- PXE ë° Kubernetes ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì„ ìœ„í•´ VM ë‹¹ 3ê°œì˜ NIC ì‚¬ìš©:
  - **NIC1:** Managementìš© (PXE ì„œë²„ ë° Ansible ê´€ë¦¬ ìš©ë„)
  - **NIC2 (VLAN 5):** Internal ë„¤íŠ¸ì›Œí¬ ìš©ë„ (ë‚´ë¶€ Kubernetes íŠ¸ë˜í”½)
  - **NIC3 (VLAN 6):** External ë„¤íŠ¸ì›Œí¬ ìš©ë„ (ì™¸ë¶€ ì ‘ê·¼ ìš©ë„, ì¸í„°ë„· ë“±)

### VM NIC êµ¬ì„± ë° VLAN

| ìš©ë„ | NIC êµ¬ì„± | VLAN |
|------|----------|------|
| Management (PXE/Ansible) | NIC1 | ë¯¸ì„¤ì • |
| Internal Network (K8s í†µì‹ ) | NIC2 | VLAN 5 |
| External Network (ì™¸ë¶€) | NIC3 | VLAN 6 |

### VM IP ë° MAC

| ë…¸ë“œ | í˜¸ìŠ¤íŠ¸ëª… | Management NIC1 | Internal NIC2 | External NIC3 | MAC |
|------|------------------------|------------------|-----------------|-----------------|---------------------|
| Bootstrap | bootstrap.example.com | 192.168.0.101 | 172.16.0.101 | 172.26.0.101 | 02:AA:00:00:01:01 |
| Controller | controller1.example.com | 192.168.0.110 | 172.16.0.110 | 172.26.0.110 | 02:AA:00:00:01:10 |
| Storage | storage1.example.com | 192.168.0.200 | 172.16.0.200 | 172.26.0.200 | 02:AA:00:00:02:00 |
| Compute1 | compute1.example.com | 192.168.0.120 | 172.16.0.120 | 172.26.0.120 | 02:BB:00:00:01:20 |
| Compute2 | compute2.example.com | 192.168.0.121 | 172.16.0.121 | 172.26.0.121 | 02:BB:00:00:01:21 |
| Compute3 | compute3.example.com | 192.168.0.122 | 172.16.0.122 | 172.26.0.122 | 02:BB:00:00:01:22 |

---

## ìš”êµ¬ ì‚¬í•­ (Requirements)

- Windows 11 (Hyper-V í™œì„±í™” í•„ìˆ˜)
- Rocky Linux 9 ISO
- Ansible 2.9 ì´ìƒ (ê¶Œì¥ 2.13 ì´ìƒ)
- Kubernetes v1.30
- Container Runtime: containerd ë˜ëŠ” CRI-O
- CNI í”ŒëŸ¬ê·¸ì¸: Flannel ë˜ëŠ” Calico

---

## êµ¬ì¶• ë°©ë²• (Installation)

### PXE ì„œë²„ êµ¬ì„±
- ë¶€íŠ¸ìŠ¤íŠ¸ë© ë…¸ë“œ VM ìƒì„± (Rocky Linux 9 ì„¤ì¹˜)
- DHCP/TFTP ì„œë²„ ì„¤ì • (`/etc/dhcp/dhcpd.conf`)
- TFTP ë””ë ‰í„°ë¦¬ ì„¤ì • (`/var/lib/tftpboot`)
- Kickstart ì„¤ì •ìœ¼ë¡œ OS ë¬´ì¸ ì„¤ì¹˜ ìë™í™”

### Ansible í™˜ê²½ êµ¬ì¶•
- Ansible ì„¤ì¹˜ ë° ì¸ë²¤í† ë¦¬ êµ¬ì„±
- SSH í‚¤ ë°°í¬ (ë¹„ë°€ë²ˆí˜¸ ì—†ëŠ” ì ‘ì† í™˜ê²½ êµ¬ì¶•)
- Kubernetes ì„¤ì¹˜ ë° ì„¤ì • í”Œë ˆì´ë¶ ì‹¤í–‰

```bash
ansible-playbook -i inventory.ini k8s_install.yml
```

---

## ì‚¬ìš© ì˜ˆì‹œ (Usage)

1. VM PXE ë¶€íŒ… í›„ OS ìë™ ì„¤ì¹˜
2. Ansible í”Œë ˆì´ë¶ ì‹¤í–‰í•˜ì—¬ Kubernetes ì„¤ì¹˜ ìë™í™”
3. Kubernetes ë…¸ë“œ ìƒíƒœ í™•ì¸

```bash
kubectl get nodes
```

---

## ê²°ê³¼ ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

- Kubernetes í´ëŸ¬ìŠ¤í„° ì •ìƒ ë™ì‘ í™•ì¸

```bash
kubectl create deployment nginx --image=nginx
kubectl expose deployment nginx --port=80 --type=NodePort
kubectl get svc
```

---

## íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ê²½í—˜

- **DHCP IP í• ë‹¹ ë¬¸ì œ**: MAC ì£¼ì†Œ ê¸°ë°˜ IP ì˜ˆì•½ ì„¤ì •ì„ í†µí•´ í•´ê²°
- **Hyper-V VM ì„¸ëŒ€ ë¬¸ì œ**: BIOS ê¸°ë°˜ PXE ë¶€íŒ…ì„ ìœ„í•´ 1ì„¸ëŒ€(Gen 1) VM ì‚¬ìš©
- **ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ì¸ì‹ ë¬¸ì œ**: ë ˆê±°ì‹œ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ì¶”ê°€í•˜ì—¬ í•´ê²°

---

## í”¼ë“œë°± ë° í–¥í›„ ë””ë²¨ë¡­ ë°©í–¥ì„±

- PXE ì„œë²„ ìë™í™”ë¡œ OS ì„¤ì¹˜ ë° ê³ ì • IP ë¶€ì—¬
- Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ìë™í™”ë¡œ ë°˜ë³µ ì‘ì—… ê°ì†Œ
- í–¥í›„ AWS Collectionì„ ì‚¬ìš©í•œ í´ë¼ìš°ë“œ í™•ì¥ ê³ ë ¤

---

## ì°¸ê³  ìë£Œ

- [Kubernetes Documentation](https://kubernetes.io/docs/home/)
- [Ansible Documentation](https://docs.ansible.com/)
- [PXE Booting Example Blog](https://pinetreeday.tistory.com/176)
- [Rocky Linux](https://rockylinux.org)

---

â€» ë³¸ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ ë°œí‘œ ë° ë¬¸ì„œí™”ë¥¼ ìœ„í•´ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¸ë¶€ ì„¤ì • íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸ëŠ” ê° í´ë”ë¥¼ ì°¸ì¡°í•´ ì£¼ì„¸ìš”.
